<!DOCTYPE html>
<html lang="id">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Monitoring Lampu</title>
    <style>
body { 
    font-family: Arial, sans-serif; 
    text-align: center; 
    background-color: #f4f4f4; 
}

.container { 
    max-width: 400px; 
    margin: auto; 
    padding: 20px; 
    background: white; 
    box-shadow: 0px 4px 6px rgba(0,0,0,0.1); 
    border-radius: 10px; 
}

h1 { 
    color: #333; 
}

.button { 
    padding: 15px; 
    width: 100px; 
    margin: 10px; 
    border: none; 
    border-radius: 5px; 
    color: white; 
    font-size: 18px; 
    cursor: pointer; 
    display: inline-block;
    text-decoration: none;
    text-align: center;
    transition: background 0.3s;
}

.on { 
    background-color: #4CAF50 !important;
}

.off { 
    background-color: #f44336 !important;
}

.button:active {
    transform: scale(0.95);
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Kontrol & Monitoring Lampu</h1>

        <p>Lampu 1 - Status <span id="output26State">off</span></p>
        <p><a id="btn26" class="button on">ON</a></p>
        <p>Arus masuk: <span id="current26">0.00</span> A</p>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAg0iHEHDLMjTlW1-Zfc8SfFnMNk4qYrGI",
            authDomain: "lampuweb-4fe3f.firebaseapp.com",
            databaseURL: "https://lampuweb-4fe3f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lampuweb-4fe3f",
            storageBucket: "lampuweb-4fe3f.appspot.com",
            messagingSenderId: "330164388666",
            appId: "1:330164388666:web:0b66cb678a984dd3c6c603",
            measurementId: "G-36QSQQBTJL"
        };

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Ambil elemen tombol
        let btn26 = document.getElementById("btn26");

        // Update tampilan tombol
        function updateButton(btn, pin, state) {
            let stateElem = document.getElementById("output" + pin + "State");
            stateElem.textContent = state;

            if (state === "on") {
                btn.textContent = "OFF";
                btn.classList.add("off");
                btn.classList.remove("on");
            } else {
                btn.textContent = "ON";
                btn.classList.add("on");
                btn.classList.remove("off");
            }
        }

        // Set lampu di Firebase
        function setLampu(pin, state) {
            let updates = { state: state };

            // kalau OFF â†’ arus kosong
            if (state === "off") {
                updates.arus = "0.00";
            }

            set(ref(db, "lampu/" + pin), updates);
        }

        // Event listener tombol
        btn26.addEventListener("click", function () {
            let currentState = document.getElementById("output26State").textContent;
            let newState = currentState === "on" ? "off" : "on";
            setLampu(26, newState);
        });

        // Listener realtime Firebase
        onValue(ref(db, "lampu/26"), (snapshot) => {
            let data = snapshot.val();
            if (data) {
                updateButton(btn26, 26, data.state);
                document.getElementById("current26").textContent = 
                    parseFloat(data.arus ?? 0).toFixed(2);
            }
        });
    </script>
</body>
</html>

